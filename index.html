<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°ç¸æ—…è¡Œè¨˜ ğŸ¾</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #E0F2FE; color: #1A1A1A; overflow-x: hidden; }
        .neo-brutal { border: 4px solid #000; box-shadow: 6px 6px 0px #000; transition: all 0.1s; cursor: pointer; background-color: white; }
        .neo-brutal:active { box-shadow: 0px 0px 0px #000; transform: translate(4px, 4px); }
        .page { display: none; padding-bottom: 120px; animation: fadeIn 0.3s ease-out; }
        .page-active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .orange-accent { background-color: #FF8A00; }
    </style>
</head>
<body class="p-4">

    <div id="page-home" class="page page-active">
        <header class="mb-6 flex justify-between items-center">
            <div>
                <h1 class="text-4xl font-black italic">PANGUI! ğŸ¶</h1>
                <p class="font-bold text-blue-600">æ—…ç¨‹è³‡æ–™å·²åŒæ­¥ â˜ï¸</p>
            </div>
            <div class="neo-brutal orange-accent w-12 h-12 flex items-center justify-center font-black">JP</div>
        </header>
        
        <div class="grid grid-cols-2 gap-4">
            <div onclick="showPage('page-itinerary')" class="col-span-2 neo-brutal p-6 relative h-40 overflow-hidden">
                <span class="absolute right-[-10px] bottom-[-10px] text-8xl opacity-10">ğŸ—¾</span>
                <h2 class="text-2xl font-black">æŸ¥çœ‹è¡Œç¨‹è¡¨</h2>
                <div id="home-itinerary-hint" class="mt-2 text-orange-600 font-bold">é»æ“Šé–‹å§‹è¦åŠƒ ></div>
            </div>
            <div onclick="showPage('page-calc')" class="neo-brutal bg-orange-400 p-4 text-center">
                <span class="text-3xl">ğŸ’´</span><p class="font-black mt-1">åŒ¯ç‡è¨˜å¸³</p>
            </div>
            <div onclick="showPage('page-list-luggage')" class="neo-brutal bg-green-300 p-4 text-center">
                <span class="text-3xl">ğŸ“¦</span><p class="font-black mt-1">è¡Œææ¸…å–®</p>
            </div>
            <div onclick="showPage('page-list-gifts')" class="neo-brutal bg-purple-300 p-4 text-center">
                <span class="text-3xl">ğŸ</span><p class="font-black mt-1">ä¼´æ‰‹ç¦®</p>
            </div>
            <div onclick="clearAllData()" class="neo-brutal bg-red-300 p-4 text-center">
                <span class="text-3xl">ğŸ—‘ï¸</span><p class="font-black mt-1">é‡è¨­è³‡æ–™</p>
            </div>
        </div>
    </div>

    <div id="page-itinerary" class="page">
        <button onclick="showPage('page-home')" class="mb-4 font-black">â† è¿”å›é¦–é </button>
        <h2 class="text-3xl font-black mb-6">æ—…éŠæ™‚é–“è»¸ ğŸ“</h2>
        <div id="itinerary-list" class="space-y-6 border-l-4 border-black ml-4 pl-6 relative">
            </div>
    </div>

    <div id="page-calc" class="page">
        <button onclick="showPage('page-home')" class="mb-4 font-black">â† è¿”å›</button>
        <div class="neo-brutal bg-black text-white p-6 mb-4">
            <div class="text-4xl font-black text-orange-400">Â¥ <span id="jpy-val">0</span></div>
            <div class="mt-2 text-2xl font-black text-white">NT$ <span id="twd-val">0</span></div>
        </div>
        <div class="grid grid-cols-3 gap-3 mb-6">
            <button onclick="calc(1)" class="neo-brutal py-4 text-2xl font-black">1</button>
            <button onclick="calc(2)" class="neo-brutal py-4 text-2xl font-black">2</button>
            <button onclick="calc(3)" class="neo-brutal py-4 text-2xl font-black">3</button>
            <button onclick="calc(4)" class="neo-brutal py-4 text-2xl font-black">4</button>
            <button onclick="calc(5)" class="neo-brutal py-4 text-2xl font-black">5</button>
            <button onclick="calc(6)" class="neo-brutal py-4 text-2xl font-black">6</button>
            <button onclick="calc(7)" class="neo-brutal py-4 text-2xl font-black">7</button>
            <button onclick="calc(8)" class="neo-brutal py-4 text-2xl font-black">8</button>
            <button onclick="calc(9)" class="neo-brutal py-4 text-2xl font-black">9</button>
            <button onclick="calc('C')" class="neo-brutal bg-red-400 py-4 text-2xl font-black">C</button>
            <button onclick="calc(0)" class="neo-brutal py-4 text-2xl font-black">0</button>
            <button onclick="saveExpense()" class="neo-brutal orange-accent py-4 text-xl font-black">SAVE</button>
        </div>
        <h3 class="font-black mb-2">æœ€è¿‘é–‹éŠ·ï¼š</h3>
        <div id="expense-history" class="space-y-2"></div>
    </div>

    <div id="page-list-luggage" class="page">
        <button onclick="showPage('page-home')" class="mb-4 font-black">â† è¿”å›</button>
        <h2 class="text-3xl font-black mb-6">è¡Œææª¢æŸ¥ ğŸ’</h2>
        <div id="luggage-list" class="space-y-3"></div>
    </div>

    <div id="page-list-gifts" class="page">
        <button onclick="showPage('page-home')" class="mb-4 font-black">â† è¿”å›</button>
        <h2 class="text-3xl font-black mb-6">ä¼´æ‰‹ç¦®æ¸…å–® ğŸ</h2>
        <div id="gifts-list" class="space-y-3"></div>
    </div>

    <div class="fixed bottom-6 left-0 right-0 px-8">
        <button onclick="handleGlobalAdd()" class="w-full neo-brutal orange-accent py-4 text-xl font-black shadow-[8px_8px_0px_#000]">
            ï¼‹ æ–°å¢è¡Œç¨‹ / æ¸…å–®
        </button>
    </div>

    <script>
        // --- åˆå§‹åŒ–è³‡æ–™åº« ---
        let db = JSON.parse(localStorage.getItem('travel_db')) || {
            itinerary: [{time: "09:00", title: "æŠµé”æ©Ÿå ´ âœˆï¸"}],
            expenses: [],
            luggage: [{text: "è­·ç…§", checked: false}, {text: "è¡Œå‹•é›»æº", checked: false}],
            gifts: [{text: "æ±äº¬èŠ­å¨œå¨œ", checked: false}]
        };

        function saveDB() {
            localStorage.setItem('travel_db', JSON.stringify(db));
            renderAll();
        }

        // --- è·¯ç”±ç³»çµ± ---
        let currentPage = 'page-home';
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('page-active'));
            document.getElementById(pageId).classList.add('page-active');
            currentPage = pageId;
            window.scrollTo(0,0);
        }

        // --- å…¨åŸŸæ–°å¢åŠŸèƒ½ ---
        function handleGlobalAdd() {
            if (currentPage === 'page-itinerary' || currentPage === 'page-home') {
                const time = prompt("è¼¸å…¥æ™‚é–“ (ä¾‹å¦‚ 14:00):", "12:00");
                const title = prompt("è¼¸å…¥è¡Œç¨‹å…§å®¹:", "åƒæ‹‰éºµ ğŸœ");
                if (title) {
                    db.itinerary.push({time, title});
                    saveDB();
                    showPage('page-itinerary');
                }
            } else if (currentPage === 'page-list-luggage') {
                const text = prompt("æ–°å¢è¡Œæç‰©å“:");
                if (text) { db.luggage.push({text, checked: false}); saveDB(); }
            } else if (currentPage === 'page-list-gifts') {
                const text = prompt("æ–°å¢æƒ³è²·çš„ç¦®ç‰©:");
                if (text) { db.gifts.push({text, checked: false}); saveDB(); }
            } else if (currentPage === 'page-calc') {
                alert("è«‹ç›´æ¥ä½¿ç”¨è¨ˆç®—æ©Ÿè¼¸å…¥é‡‘é¡å¾ŒæŒ‰ SAVE");
            }
        }

        // --- è¨˜å¸³åŠŸèƒ½ ---
        let jpy = "0";
        function calc(val) {
            if (val === 'C') jpy = "0";
            else if (jpy === "0") jpy = val.toString();
            else jpy += val.toString();
            document.getElementById('jpy-val').innerText = jpy;
            document.getElementById('twd-val').innerText = Math.round(parseInt(jpy) * 0.21);
        }

        function saveExpense() {
            if (jpy === "0") return;
            const amt = Math.round(parseInt(jpy) * 0.21);
            const note = prompt("é€™ç­†éŒ¢èŠ±åœ¨å“ªè£¡ï¼Ÿ", "ä¸€èˆ¬æ¶ˆè²»");
            db.expenses.unshift({note, jpy: jpy, twd: amt});
            jpy = "0";
            calc('C');
            saveDB();
        }

        // --- æ¸²æŸ“ç³»çµ± ---
        function renderAll() {
            // æ¸²æŸ“è¡Œç¨‹
            const itinBox = document.getElementById('itinerary-list');
            itinBox.innerHTML = db.itinerary.map(i => `
                <div class="neo-brutal p-4 relative mb-4">
                    <div class="absolute -left-[38px] top-4 w-6 h-6 rounded-full bg-orange-400 border-4 border-black"></div>
                    <span class="text-sm font-black text-orange-600">${i.time}</span>
                    <h4 class="font-black text-lg">${i.title}</h4>
                </div>
            `).join('');

            // æ¸²æŸ“æ¸…å–® (è¡Œæ & ä¼´æ‰‹ç¦®)
            renderChecklist('luggage-list', db.luggage);
            renderChecklist('gifts-list', db.gifts);

            // æ¸²æŸ“è¨˜å¸³æ­·å²
            document.getElementById('expense-history').innerHTML = db.expenses.slice(0, 5).map(e => `
                <div class="flex justify-between p-2 border-b-2 border-black font-bold text-sm">
                    <span>${e.note}</span>
                    <span>Â¥${e.jpy} â†’ <span class="text-orange-600">NT$${e.twd}</span></span>
                </div>
            `).join('');
        }

        function renderChecklist(id, dataArray) {
            document.getElementById(id).innerHTML = dataArray.map((item, index) => `
                <div onclick="toggleItem('${id}', ${index})" class="neo-brutal p-4 flex justify-between items-center font-black ${item.checked ? 'bg-green-200' : ''}">
                    <span>${item.text}</span>
                    <div class="w-6 h-6 border-4 border-black ${item.checked ? 'bg-black' : 'bg-white'}"></div>
                </div>
            `).join('');
        }

        function toggleItem(type, index) {
            const key = type.split('-')[0]; // luggage or gifts
            db[key][index].checked = !db[key][index].checked;
            saveDB();
        }

        function clearAllData() {
            if(confirm("ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰æ—…éŠè¦åŠƒå—ï¼Ÿ")) {
                localStorage.removeItem('travel_db');
                location.reload();
            }
        }

        // å•Ÿå‹•æ¸²æŸ“
        renderAll();
    </script>
</body>
</html>
